# DotMac Platform Environment Configuration Template
# Copy this file to .env and customize for your environment
# NEVER commit .env files with real secrets to version control

# ===== APPLICATION SETTINGS =====
ENVIRONMENT=production
DEBUG=false
LOG_LEVEL=INFO
APP_NAME="DotMac ISP Framework"
APP_VERSION=1.0.0

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================
# PostgreSQL (primary database)
# Secrets are stored in Vault at: dotmac/database/main
DATABASE_URL=vault:dotmac/database/main#url
DATABASE_MAX_CONNECTIONS=20
DATABASE_POOL_TIMEOUT=30

# Test database (for running tests)
# Secrets are stored in Vault at: dotmac/database/test
TEST_DATABASE_URL=vault:dotmac/database/test#url

# =============================================================================
# CACHE & SESSION STORAGE
# =============================================================================
# Redis (caching and sessions)
# Secrets are stored in Vault at: dotmac/cache/redis
REDIS_URL=vault:dotmac/cache/redis#url
REDIS_PASSWORD=vault:dotmac/cache/redis#password

# Session configuration
# Secret stored in Vault at: dotmac/auth/session
SESSION_SECRET_KEY=vault:dotmac/auth/session#secret_key
SESSION_TIMEOUT=3600

# =============================================================================
# SECURITY
# =============================================================================
# JWT Configuration
# Secret stored in Vault at: dotmac/auth/jwt
JWT_SECRET_KEY=vault:dotmac/auth/jwt#secret
JWT_ALGORITHM=HS256
JWT_EXPIRATION_HOURS=24

# API Keys
# Secrets stored in Vault at: dotmac/api_keys/*
API_SECRET_KEY=vault:dotmac/api_keys/main#key
WEBHOOK_SECRET=vault:dotmac/api_keys/webhook#secret

# Encryption
# Key stored in Vault at: dotmac/encryption/master
ENCRYPTION_KEY=vault:dotmac/encryption/master#key

# =============================================================================
# EXTERNAL SERVICES
# =============================================================================
# Email Service (SMTP)
# Credentials stored in Vault at: dotmac/smtp/default
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=vault:dotmac/smtp/default#username
SMTP_PASSWORD=vault:dotmac/smtp/default#password
SMTP_USE_TLS=true
FROM_EMAIL=noreply@your-domain.com

# SMS Service (Twilio)
# Credentials stored in Vault at: dotmac/api_keys/twilio
TWILIO_ACCOUNT_SID=vault:dotmac/api_keys/twilio#account_sid
TWILIO_AUTH_TOKEN=vault:dotmac/api_keys/twilio#auth_token
TWILIO_PHONE_NUMBER=vault:dotmac/api_keys/twilio#phone_number

# Payment Processing (Stripe)
# Credentials stored in Vault at: dotmac/api_keys/stripe
STRIPE_PUBLIC_KEY=vault:dotmac/api_keys/stripe#public_key
STRIPE_SECRET_KEY=vault:dotmac/api_keys/stripe#secret_key
STRIPE_WEBHOOK_SECRET=vault:dotmac/api_keys/stripe#webhook_secret

# =============================================================================
# CLOUD SERVICES
# =============================================================================
# AWS (if using AWS services)
# Credentials stored in Vault at: dotmac/cloud/aws
AWS_ACCESS_KEY_ID=vault:dotmac/cloud/aws#access_key_id
AWS_SECRET_ACCESS_KEY=vault:dotmac/cloud/aws#secret_access_key
AWS_DEFAULT_REGION=us-east-1
AWS_S3_BUCKET=vault:dotmac/cloud/aws#s3_bucket

# File Storage
STORAGE_BACKEND=local  # Options: local, s3, gcs
UPLOAD_MAX_SIZE=10485760  # 10MB in bytes
ALLOWED_FILE_TYPES=pdf,doc,docx,jpg,jpeg,png

# =============================================================================
# MONITORING & OBSERVABILITY
# =============================================================================
# Sentry (error tracking)
# DSN stored in Vault at: dotmac/monitoring/sentry
SENTRY_DSN=vault:dotmac/monitoring/sentry#dsn

# Application Monitoring
TELEMETRY_ENABLED=true
METRICS_ENDPOINT=http://localhost:8080/metrics

# =============================================================================
# API CONFIGURATION
# =============================================================================
# API Gateway
API_GATEWAY_URL=http://localhost:8000
API_VERSION=v1
API_RATE_LIMIT=1000  # requests per hour per IP

# CORS Configuration
CORS_ORIGINS=http://localhost:3000,http://localhost:8080
CORS_ALLOW_CREDENTIALS=true

# =============================================================================
# NETWORKING & INFRASTRUCTURE
# =============================================================================
# Network Management
# SNMP credentials stored in Vault at: dotmac/network/snmp
SNMP_COMMUNITY=vault:dotmac/network/snmp#community
SNMP_VERSION=2c
NETWORK_SCAN_INTERVAL=300  # seconds

# Equipment Management
EQUIPMENT_AUTO_DISCOVERY=true
DEVICE_POLLING_INTERVAL=60  # seconds

# =============================================================================
# BILLING & BUSINESS
# =============================================================================
# Billing Configuration
BILLING_CYCLE_DAY=1  # Day of month to generate invoices
PAYMENT_GRACE_PERIOD=5  # Days after due date
LATE_FEE_PERCENTAGE=5.0

# Tax Configuration
DEFAULT_TAX_RATE=8.25  # percentage
TAX_CALCULATION=inclusive  # Options: inclusive, exclusive

# =============================================================================
# CUSTOMER PORTAL
# =============================================================================
# Portal Configuration
PORTAL_URL=http://localhost:8001
PORTAL_SESSION_TIMEOUT=1800  # 30 minutes
CUSTOMER_SIGNUP_ENABLED=true

# =============================================================================
# RESELLER PORTAL
# =============================================================================
# Reseller Configuration
RESELLER_PORTAL_URL=http://localhost:8002
RESELLER_COMMISSION_RATE=10.0  # percentage
RESELLER_SIGNUP_APPROVAL=manual  # Options: automatic, manual

# =============================================================================
# DEVELOPMENT & TESTING
# =============================================================================
# Development Tools
ENABLE_DEBUG_TOOLBAR=true
ENABLE_PROFILING=false
MOCK_EXTERNAL_SERVICES=true

# Testing Configuration
RUN_INTEGRATION_TESTS=false
TEST_PAYMENT_MODE=true  # Use test payment processors
GENERATE_TEST_DATA=false

# =============================================================================
# PERFORMANCE
# =============================================================================
# Cache Configuration
CACHE_TTL=3600  # Default cache timeout in seconds
CACHE_MAX_ENTRIES=10000

# Worker Configuration
CELERY_BROKER_URL=redis://localhost:6379/1
CELERY_RESULT_BACKEND=redis://localhost:6379/2
WORKER_CONCURRENCY=4

# =============================================================================
# BACKUP & MAINTENANCE
# =============================================================================
# Backup Configuration
BACKUP_ENABLED=true
BACKUP_SCHEDULE="0 2 * * *"  # Daily at 2 AM
BACKUP_RETENTION_DAYS=30
BACKUP_S3_BUCKET=your-backup-bucket

# Maintenance Mode
MAINTENANCE_MODE=false
MAINTENANCE_MESSAGE="System maintenance in progress"

# =============================================================================
# LOGGING
# =============================================================================
# Log Configuration
LOG_FORMAT=json  # Options: text, json
LOG_FILE_ENABLED=true
LOG_FILE_PATH=/var/log/dotmac/app.log
LOG_FILE_MAX_SIZE=100MB
LOG_FILE_BACKUP_COUNT=5

# External Logging
ELK_ENABLED=false
ELK_HOST=localhost
ELK_PORT=9200

# =============================================================================
# SECURITY HEADERS & POLICIES
# =============================================================================
# Security Headers
SECURE_SSL_REDIRECT=false  # Set to true in production
SECURE_HSTS_SECONDS=31536000
SECURE_CONTENT_TYPE_NOSNIFF=true
SECURE_FRAME_DENY=true

# Content Security Policy
CSP_DEFAULT_SRC="'self'"
CSP_SCRIPT_SRC="'self' 'unsafe-inline'"
CSP_STYLE_SRC="'self' 'unsafe-inline'"

# =============================================================================
# FEATURE FLAGS
# =============================================================================
# Feature Toggles
FEATURE_ANALYTICS_DASHBOARD=true
FEATURE_AUTOMATED_BILLING=true
FEATURE_CUSTOMER_SELF_SERVICE=true
FEATURE_RESELLER_PORTAL=true
FEATURE_NETWORK_MONITORING=true
FEATURE_EQUIPMENT_MANAGEMENT=true

# Beta Features
BETA_AI_RECOMMENDATIONS=false
BETA_PREDICTIVE_MAINTENANCE=false
BETA_ADVANCED_ANALYTICS=false

# =============================================================================
# SECRET MANAGEMENT CONFIGURATION
# =============================================================================
# Choose between OpenBao (recommended open-source) or HashiCorp Vault

# Option 1: OpenBao (Recommended - Open Source Fork of Vault)
USE_OPENBAO=true  # Set to true to use OpenBao instead of Vault
OPENBAO_ADDR=http://localhost:8200
OPENBAO_TOKEN=  # Set via environment or use AppRole/Kubernetes auth
OPENBAO_NAMESPACE=  # Optional: OpenBao namespace
OPENBAO_AUTH_METHOD=token  # Options: token, approle, kubernetes, aws
OPENBAO_ROLE_ID=  # For AppRole auth
OPENBAO_SECRET_ID=  # For AppRole auth
OPENBAO_MOUNT_POINT=secret
OPENBAO_KV_VERSION=2

# Option 2: HashiCorp Vault (Legacy - requires license for production)
# Uncomment these lines if you still use HashiCorp Vault
# VAULT_ADDR=http://localhost:8200
# VAULT_TOKEN=  # Set via environment or use AppRole/Kubernetes auth
# VAULT_NAMESPACE=  # Optional: Vault namespace
# VAULT_AUTH_METHOD=token  # Options: token, approle, kubernetes, aws
# VAULT_ROLE_ID=  # For AppRole auth
# VAULT_SECRET_ID=  # For AppRole auth
# VAULT_MOUNT_POINT=secret
# VAULT_KV_VERSION=2

# Common configuration (works with both OpenBao and Vault)
VAULT_APP_PREFIX=dotmac

# =============================================================================
# NOTES
# =============================================================================
# 1. All secrets are managed through OpenBao (or HashiCorp Vault)
# 2. Format: vault:<path>#<key> references a secret in OpenBao/Vault
# 3. Never store actual secrets in this file
# 4. In production, use AppRole or Kubernetes authentication
# 5. Secrets are automatically rotated according to policies
# 6. Use HTTPS for OpenBao/Vault connection in production
# 7. Enable audit logging for compliance
# 8. Set up policies for least-privilege access
# 9. OpenBao is API-compatible with Vault - no code changes needed
# 10. Migration guide: deployments/OPENTOFU_MIGRATION.md