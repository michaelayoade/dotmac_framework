# Additional Nginx Performance Optimizations
# Add to existing nginx.conf or create nginx-performance.conf

# Worker process optimization
worker_processes auto;
worker_connections 4096;
worker_rlimit_nofile 65535;

# Buffer optimizations
client_body_buffer_size 128k;
client_header_buffer_size 1k;
large_client_header_buffers 4 4k;
output_buffers 1 32k;
postpone_output 1460;

# Timeout optimizations
client_header_timeout 3m;
client_body_timeout 3m;
send_timeout 3m;

# Compression optimization (already in nginx.conf but ensure it's optimal)
gzip_vary on;
gzip_min_length 1024;
gzip_proxied any;
gzip_comp_level 6;
gzip_buffers 16 8k;
gzip_http_version 1.1;

# Caching for static files
location ~* \.(jpg|jpeg|gif|png|css|js|ico|xml)$ {
    access_log off;
    log_not_found off;
    expires 1y;
    add_header Cache-Control "public, immutable";
    add_header Vary Accept-Encoding;
}

# Enable HTTP/2 push for critical resources
location = /index.html {
    http2_push /css/main.css;
    http2_push /js/app.js;
}

# Rate limiting optimization
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;
limit_req_zone $binary_remote_addr zone=auth_limit:10m rate=5r/m;
limit_conn_zone $binary_remote_addr zone=conn_limit:10m;

# Connection optimization
keepalive_timeout 65;
keepalive_requests 100;
