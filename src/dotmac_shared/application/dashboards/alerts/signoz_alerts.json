[
  {
    "id": "dotmac-login-success-rate",
    "alert": "Login Success Rate SLO",
    "condition": {
      "queryType": "builder",
      "promql": "rate(dotmac_management_login_attempts_total{result=\"success\"}[5m]) / rate(dotmac_management_login_attempts_total[5m])",
      "builder": {
        "queryName": "A",
        "metricName": "dotmac_management_login_attempts_total",
        "tagFilters": {
          "items": [
            {
              "key": "result",
              "op": "=",
              "value": "success"
            }
          ]
        },
        "aggregateOperator": "rate",
        "aggregateAttribute": {
          "key": "5m"
        }
      }
    },
    "evalFor": "2m",
    "frequency": "1m",
    "condition_op": "<",
    "target": 0.98,
    "severity": "critical",
    "labels": {
      "service": "management-platform",
      "slo_type": "authentication",
      "alert_type": "business_slo"
    },
    "annotations": {
      "title": "Login Success Rate Below SLO",
      "description": "Login success rate ({{ $value }}%) is below the 98% SLO threshold",
      "playbook": "https://docs.dotmac.com/runbooks/authentication-issues"
    },
    "preferredChannels": ["pagerduty", "slack"]
  },
  {
    "id": "dotmac-provisioning-latency",
    "alert": "Container Provisioning Latency SLO", 
    "condition": {
      "queryType": "builder",
      "promql": "histogram_quantile(0.95, rate(dotmac_management_provisioning_duration_seconds_bucket[5m]))",
      "builder": {
        "queryName": "A",
        "metricName": "dotmac_management_provisioning_duration_seconds_bucket",
        "aggregateOperator": "hist_quantile_95",
        "aggregateAttribute": {
          "key": "5m"
        }
      }
    },
    "evalFor": "5m",
    "frequency": "1m", 
    "condition_op": ">",
    "target": 60,
    "severity": "warning",
    "labels": {
      "service": "management-platform",
      "slo_type": "provisioning",
      "alert_type": "business_slo"
    },
    "annotations": {
      "title": "Container Provisioning Latency High",
      "description": "Container provisioning P95 latency ({{ $value }}s) is above the 60s SLO threshold",
      "playbook": "https://docs.dotmac.com/runbooks/provisioning-failures"
    },
    "preferredChannels": ["slack"]
  },
  {
    "id": "isp-customer-login-success",
    "alert": "Customer Login Success Rate SLO",
    "condition": {
      "queryType": "builder", 
      "promql": "rate(isp_framework_login_attempts_total{result=\"success\"}[5m]) / rate(isp_framework_login_attempts_total[5m])",
      "builder": {
        "queryName": "A",
        "metricName": "isp_framework_login_attempts_total",
        "tagFilters": {
          "items": [
            {
              "key": "result",
              "op": "=",
              "value": "success"
            }
          ]
        },
        "aggregateOperator": "rate",
        "aggregateAttribute": {
          "key": "5m"
        }
      }
    },
    "evalFor": "2m",
    "frequency": "1m",
    "condition_op": "<",
    "target": 0.98,
    "severity": "critical",
    "labels": {
      "service": "isp-framework",
      "slo_type": "customer_authentication", 
      "alert_type": "business_slo"
    },
    "annotations": {
      "title": "Customer Login Success Rate Below SLO",
      "description": "Customer login success rate ({{ $value }}%) is below the 98% SLO threshold for tenant {{ $labels.tenant_id }}",
      "playbook": "https://docs.dotmac.com/runbooks/customer-login-issues"
    },
    "preferredChannels": ["pagerduty", "slack"]
  },
  {
    "id": "isp-service-provisioning-time",
    "alert": "Service Provisioning Time SLO",
    "condition": {
      "queryType": "builder",
      "promql": "histogram_quantile(0.95, rate(isp_framework_provisioning_duration_seconds_bucket[5m]))",
      "builder": {
        "queryName": "A",
        "metricName": "isp_framework_provisioning_duration_seconds_bucket",
        "aggregateOperator": "hist_quantile_95",
        "aggregateAttribute": {
          "key": "5m"
        },
        "groupBy": ["service_type", "tenant_id"]
      }
    },
    "evalFor": "5m",
    "frequency": "1m",
    "condition_op": ">", 
    "target": 60,
    "severity": "warning",
    "labels": {
      "service": "isp-framework",
      "slo_type": "service_provisioning",
      "alert_type": "business_slo"
    },
    "annotations": {
      "title": "Service Provisioning Time Above SLO",
      "description": "Service provisioning P95 time ({{ $value }}s) is above the 60s SLO threshold for {{ $labels.service_type }} on tenant {{ $labels.tenant_id }}",
      "playbook": "https://docs.dotmac.com/runbooks/service-provisioning"
    },
    "preferredChannels": ["slack"]
  },
  {
    "id": "isp-support-resolution-time",
    "alert": "Customer Support Resolution Time SLO",
    "condition": {
      "queryType": "builder",
      "promql": "histogram_quantile(0.95, rate(isp_framework_customer_support_resolution_time_bucket[1h]))",
      "builder": {
        "queryName": "A",
        "metricName": "isp_framework_customer_support_resolution_time_bucket", 
        "aggregateOperator": "hist_quantile_95",
        "aggregateAttribute": {
          "key": "1h"
        },
        "groupBy": ["tenant_id"]
      }
    },
    "evalFor": "10m",
    "frequency": "5m",
    "condition_op": ">",
    "target": 3600,
    "severity": "warning",
    "labels": {
      "service": "isp-framework",
      "slo_type": "customer_support",
      "alert_type": "business_slo"
    },
    "annotations": {
      "title": "Support Resolution Time Above SLO",
      "description": "Support ticket P95 resolution time ({{ $value | humanizeDuration }}) is above the 1 hour SLO threshold for tenant {{ $labels.tenant_id }}",
      "playbook": "https://docs.dotmac.com/runbooks/support-escalation"
    },
    "preferredChannels": ["slack", "email"]
  },
  {
    "id": "billing-transaction-success",
    "alert": "Billing Transaction Success Rate SLO",
    "condition": {
      "queryType": "builder",
      "promql": "rate(isp_framework_revenue_transactions_total{result=\"success\"}[5m]) / rate(isp_framework_revenue_transactions_total[5m])",
      "builder": {
        "queryName": "A",
        "metricName": "isp_framework_revenue_transactions_total",
        "tagFilters": {
          "items": [
            {
              "key": "result",
              "op": "=", 
              "value": "success"
            }
          ]
        },
        "aggregateOperator": "rate",
        "aggregateAttribute": {
          "key": "5m"
        },
        "groupBy": ["tenant_id"]
      }
    },
    "evalFor": "1m",
    "frequency": "30s",
    "condition_op": "<",
    "target": 0.99,
    "severity": "critical",
    "labels": {
      "service": "isp-framework", 
      "slo_type": "billing",
      "alert_type": "business_slo"
    },
    "annotations": {
      "title": "Billing Success Rate Below SLO",
      "description": "Billing transaction success rate ({{ $value }}%) is below the 99% SLO threshold for tenant {{ $labels.tenant_id }}",
      "playbook": "https://docs.dotmac.com/runbooks/billing-failures"
    },
    "preferredChannels": ["pagerduty", "slack"]
  },
  {
    "id": "service-availability",
    "alert": "Service Availability SLO",
    "condition": {
      "queryType": "builder",
      "promql": "up{service=~\"dotmac-.*|isp-.*\"}",
      "builder": {
        "queryName": "A",
        "metricName": "up",
        "tagFilters": {
          "items": [
            {
              "key": "service",
              "op": "=~",
              "value": "dotmac-.*|isp-.*"
            }
          ]
        }
      }
    },
    "evalFor": "30s",
    "frequency": "10s",
    "condition_op": "==",
    "target": 0,
    "severity": "critical",
    "labels": {
      "slo_type": "availability",
      "alert_type": "infrastructure"
    },
    "annotations": {
      "title": "Service Down",
      "description": "Service {{ $labels.service }} is down and not responding to health checks",
      "playbook": "https://docs.dotmac.com/runbooks/service-down"
    },
    "preferredChannels": ["pagerduty", "sms"]
  },
  {
    "id": "customer-satisfaction-low",
    "alert": "Customer Satisfaction Below Threshold",
    "condition": {
      "queryType": "builder",
      "promql": "isp_framework_customer_satisfaction_score{score_type=\"nps\"}",
      "builder": {
        "queryName": "A",
        "metricName": "isp_framework_customer_satisfaction_score",
        "tagFilters": {
          "items": [
            {
              "key": "score_type",
              "op": "=",
              "value": "nps"
            }
          ]
        },
        "groupBy": ["tenant_id"]
      }
    },
    "evalFor": "60m",
    "frequency": "30m",
    "condition_op": "<",
    "target": 60,
    "severity": "warning",
    "labels": {
      "service": "isp-framework",
      "slo_type": "customer_experience",
      "alert_type": "business_slo"
    },
    "annotations": {
      "title": "Customer Satisfaction Low",
      "description": "Customer NPS score ({{ $value }}) is below the 60 threshold for tenant {{ $labels.tenant_id }}",
      "playbook": "https://docs.dotmac.com/runbooks/customer-satisfaction"
    },
    "preferredChannels": ["email", "slack"]
  }
]